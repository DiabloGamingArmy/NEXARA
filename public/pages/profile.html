<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexera Profile</title>
    <!-- codex connection successful. -->
    <!-- Tailwind for utilities -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- MOD: Sanitizer (use in script.js to safely render user content) -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.11/dist/purify.min.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../style.css">
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Ficon.png?alt=media&token=3db62710-7412-46bf-a981-ace4715e2bc6">
    <link rel="shortcut icon" href="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Ficon.png?alt=media&token=3db62710-7412-46bf-a981-ace4715e2bc6">
    <link rel="apple-touch-icon" href="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Ficon.png?alt=media&token=3db62710-7412-46bf-a981-ace4715e2bc6">
</head>
<body>

    <!-- Loading -->
    <div id="loading-overlay"><img class="brand-logo brand-logo-splash" data-logo-variant="auto" alt="Nexera logo" src="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Ficon.png?alt=media&token=3db62710-7412-46bf-a981-ace4715e2bc6"><div style="color:var(--text-muted);">Initializing Nexera...</div></div>

    <!-- Auth -->
    <div id="auth-screen">
        <img class="brand-logo brand-logo-auth" data-logo-variant="dark" alt="Nexera logo" src="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Fwhiteicon.png?alt=media&token=366d09a9-61f6-4096-af08-a01a119c339e">
        <div class="auth-box">
            <h2 class="nexara-gradient-text" style="margin-bottom:1rem; font-weight:800; font-size:2rem; letter-spacing: -0.5px;">Greetings, Traveler.</h2>
            <p style="color:var(--text-muted); margin-bottom: 1.5rem;">Welcome to Nexera!</p>
            <input type="email" id="email" class="form-input" placeholder="Email">
            <input type="password" id="password" class="form-input" placeholder="Password">
            <div id="auth-error" style="color:#ff3d3d; font-size:0.8rem; margin:5px 0;"></div>
            <button id="login-submit" onclick="window.handleLogin(event)" class="create-btn-sidebar" style="background: var(--primary); color:black;">Log In</button>
            <button id="signup-submit" onclick="window.handleSignup(event)" class="create-btn-sidebar" style="background:transparent; border:1px solid var(--border); color:var(--text-main); margin-top:10px;">Sign Up</button>
            <button onclick="window.handleAnon()" style="margin-top:15px; background:none; border:none; color:var(--text-muted); cursor:pointer; font-size: 0.85rem;">Continue as Guest</button>
        </div>
    </div>
</div>

<!-- Media Modal (Lightbox) -->
<div id="media-modal" class="modal-overlay" onclick="window.closeFullscreenMedia()">
    <!-- MOD: stop click inside content from closing modal -->
    <div id="media-modal-content" onclick="event.stopPropagation()" style="max-width:90vw; max-height:90vh; display:flex; justify-content:center; align-items:center;">
        <!-- Media injected here -->
    </div>
    <button onclick="window.closeFullscreenMedia()" style="position:absolute; top:20px; right:20px; background:none; border:none; color:white; font-size:2rem; cursor:pointer;">&times;</button>
</div>

<!-- Modals -->
<!-- Create Post Modal -->
<div id="create-modal" class="modal-overlay" style="align-items: flex-start; padding-top: 5vh;">
    <div class="x-modal-content">
        <div class="x-modal-header">
            <button onclick="window.toggleCreateModal(false)" class="x-close-btn">&times;</button>
            <button class="destination-field" type="button" onclick="window.openDestinationPicker()" aria-label="Select posting destination">
                <div class="destination-field-label">Posting to</div>
                <div class="destination-field-value">
                    <span id="destination-current-label">Select...</span>
                    <span id="destination-current-verified" class="verified-badge" style="display:none;"> <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 2.75a1 1 0 0 1 .8.4l1.86 2.52 3.02-.08a1 1 0 0 1 .84.46l1.64 2.56a1 1 0 0 1-.06 1.14l-1.83 2.43.73 2.95a1 1 0 0 1-.39 1.05l-2.5 1.78a1 1 0 0 1-1.12.02L12 17.85l-3.09 1.18a1 1 0 0 1-1.12-.02l-2.5-1.78a1 1 0 0 1-.39-1.05l.73-2.95-1.83-2.43a1 1 0 0 1-.06-1.14l1.64-2.56a1 1 0 0 1 .84-.46l3.02.08L11.2 3.15a1 1 0 0 1 .8-.4Zm-1.2 11 4.7-4.7-1.4-1.4-3.3 3.3-1.6-1.6-1.4 1.42 3 3Z"></path></svg> </span>
                </div>
                <div class="destination-field-chevron"><i class="ph ph-caret-right"></i></div>
                <div id="destination-loading-spinner" class="inline-spinner" aria-hidden="true"></div>
            </button>
        </div>

        <div id="destination-helper" class="category-helper" style="display:none; margin: 0 1rem;"></div>

        <div class="x-body">
            <div id="modal-user-avatar" class="x-avatar"></div>
            <div class="x-inputs">
                <select id="postVisibility" class="x-pill-select">
                    <option value="Everyone">Everyone can reply</option>
                    <option value="Followers">Followers only</option>
                    <option value="Mentions">Only people you mention</option>
                </select>

                <input type="text" id="postTitle" class="x-input-title" placeholder="Title (Optional)">
                <textarea id="postContent" class="x-input-content" placeholder="What is happening?!" rows="3"></textarea>

                <div class="composer-meta-controls">
                    <button type="button" class="icon-pill" onclick="window.toggleTagInput()"><i class="ph ph-hash"></i> # Tags</button>
                    <button type="button" class="icon-pill" onclick="window.toggleMentionInput()"><i class="ph ph-at"></i> @ Mentions</button>
                </div>
                <div id="tag-input-row" class="composer-inline" style="display:none;">
                    <input type="text" id="tag-input" class="form-input" placeholder="Add a tag" onkeydown="window.handleTagInputKey(event)" oninput="window.filterTagSuggestions(this.value)">
                    <div id="tag-suggestions" class="suggestion-row"></div>
                </div>
                <div id="composer-tags-list" class="chip-row"></div>
                <div id="mention-input-row" class="composer-inline" style="display:none;">
                    <input type="text" id="mention-input" class="form-input" placeholder="Search usernames" oninput="window.handleMentionInput(event)">
                    <div id="mention-suggestions" class="suggestion-row"></div>
                </div>
                <div id="composer-mentions-list" class="mention-row"></div>

                <div id="img-preview-container" class="attachment-preview">
                    <button onclick="window.clearPostImage()" class="remove-attachment">&times;</button>
                    <img id="img-preview-tag" src="">
                </div>

                <div id="extra-options-area" class="extra-options-panel">
                    <div id="post-opt-poll" style="display:none;">
                        <div class="composer-subheader">Poll</div>
                        <input type="text" id="poll-title-input" class="form-input" placeholder="Poll title" oninput="window.handlePollTitleChange(this.value)" style="margin-bottom:8px;">
                        <div id="poll-options-container" class="poll-options"></div>
                        <div class="poll-actions">
                            <button type="button" class="icon-pill" onclick="window.addPollOption()"><i class="ph ph-plus"></i> Add option</button>
                            <span class="poll-helper">2‚Äì5 options</span>
                        </div>
                    </div>
                    <div id="post-opt-gif" style="display:none;">
                        <input type="text" class="form-input" placeholder="Paste GIF URL..." style="margin-bottom:0;">
                    </div>
                     <div id="post-opt-schedule" style="display:none;">
                        <div class="composer-subheader">Scheduled Post</div>
                        <input type="datetime-local" id="schedule-input" class="form-input" style="margin-bottom:0;" onchange="window.handleScheduleChange(this.value)">
                    </div>
                    <div id="post-opt-location" style="display:none;">
                        <div class="composer-subheader">Location</div>
                        <input type="text" id="location-input" class="form-input" placeholder="Search locations" style="margin-bottom:6px;" oninput="window.handleLocationInput(this.value)">
                        <div id="location-suggestions" class="suggestion-row"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="x-footer">
            <div class="x-toolbar">
                <input type="file" id="postFile" style="display: none;" accept="image/*" onchange="window.previewPostImage(this)">
                <button class="x-tool-btn" onclick="document.getElementById('postFile').click()" title="Media"><i class="ph ph-camera"></i></button>
                <button class="x-tool-btn" onclick="window.togglePostOption('gif')" title="GIF"><i class="ph ph-gif"></i></button>
                <button class="x-tool-btn" onclick="window.togglePostOption('poll')" title="Poll"><i class="ph ph-chart-bar"></i></button>
                <button class="x-tool-btn" onclick="alert('Emoji picker coming soon!')" title="Emoji"><i class="ph ph-smiley"></i></button>
                <button class="x-tool-btn" onclick="window.togglePostOption('schedule')" title="Schedule"><i class="ph ph-calendar"></i></button>
                <button class="x-tool-btn" onclick="window.togglePostOption('location')" title="Location"><i class="ph ph-map-pin"></i></button>
            </div>
            <button id="publishBtn" onclick="window.createPost()" class="x-post-btn">Post</button>
        </div>
    </div>
</div>

<!-- Destination Picker Modal -->
<div id="destination-picker-modal" class="modal-overlay">
    <div class="modal-content destination-picker">
        <div class="destination-picker-header">
            <div>
                <div class="destination-picker-title">Choose where to post</div>
                <div class="destination-picker-subtitle">Select a destination for your post.</div>
            </div>
            <button onclick="window.closeDestinationPicker()" class="x-close-btn" aria-label="Close destination picker">&times;</button>
        </div>

        <div id="destination-picker-tabs" class="destination-tabs"></div>

        <div class="destination-search">
            <i class="ph ph-magnifying-glass"></i>
            <input id="destination-search-input" type="text" placeholder="Search destinations" aria-label="Search destinations">
        </div>

        <div id="destination-create-area"></div>

        <div id="destination-results" class="destination-results"></div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settings-modal" class="modal-overlay">
    <div class="modal-content">
        <h2 style="margin-bottom:1rem; font-weight:800;">Profile &amp; Settings</h2>

        <div class="settings-section">
            <div class="settings-section-header">Appearance</div>
            <div style="margin: 0.5rem 0; padding: 1rem; border:1px solid var(--border); border-radius:12px;">
                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                    <div style="font-weight:700;">Theme</div>
                    <div style="color:var(--text-muted); font-size:0.85rem;">Dark ¬∑ Light ¬∑ System</div>
                </div>
                <div class="theme-options">
                    <label class="theme-option"><input type="radio" name="theme-choice" value="dark"> Dark</label>
                    <label class="theme-option"><input type="radio" name="theme-choice" value="light"> Light</label>
                    <label class="theme-option"><input type="radio" name="theme-choice" value="system"> System</label>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <div class="settings-section-header">Public Profile</div>

                <div class="settings-avatar-row">
                    <div class="avatar-edit-wrapper">
                        <div id="settings-avatar-preview" class="profile-pic" style="width:80px; height:80px; margin:0;">
                            <span>U</span>
                            <button type="button" class="avatar-edit-btn" onclick="document.getElementById('set-pic-file').click()"><i class="ph ph-pencil"></i></button>
                        </div>
                    </div>
                    <div style="display:flex; flex-direction:column; gap:6px; width:100%;">
                        <button type="button" class="icon-pill" onclick="document.getElementById('set-pic-file').click()"><i class="ph ph-upload-simple"></i> Upload Photo</button>
                        <button type="button" class="icon-pill" onclick="document.getElementById('set-pic-camera').click()"><i class="ph ph-camera"></i> Take Photo</button>
                        <button type="button" id="remove-photo-btn" class="icon-pill" onclick="window.removeProfilePhoto()"><i class="ph ph-x-circle"></i> Remove Photo</button>
                    </div>
                </div>
            </div>

            <input type="file" id="set-pic-file" class="form-input" accept="image/*" style="display:none;">
            <input type="file" id="set-pic-camera" class="form-input" accept="image/*" capture="environment" style="display:none;">

            <div class="settings-grid">
                <div>
                    <label class="settings-label">Real Name</label>
                    <input type="text" id="set-real-name" class="form-input" placeholder="Your legal name">
                </div>
                <div>
                    <label class="settings-label">Display Name</label>
                    <input type="text" id="set-name" class="form-input" placeholder="Name shown on profile">
                </div>
            </div>

            <div class="settings-grid">
                <div>
                    <label class="settings-label">Username</label>
                    <input type="text" id="set-username" class="form-input" placeholder="@handle">
                </div>
                <div>
                    <label class="settings-label">Nickname (Optional)</label>
                    <input type="text" id="set-nickname" class="form-input" placeholder="Friends know you as...">
                </div>
            </div>

            <label class="settings-label">Bio</label>
            <textarea id="set-bio" class="form-input" placeholder="Bio"></textarea>

            <div class="settings-grid">
                <div>
                    <label class="settings-label">Website / Link</label>
                    <input type="text" id="set-website" class="form-input" placeholder="https://example.com">
                </div>
                <div>
                    <label class="settings-label">Region / Location</label>
                    <input type="text" id="set-region" class="form-input" placeholder="City, Country">
                </div>
            </div>

            <div class="settings-grid">
                <div>
                    <label class="settings-label">Email</label>
                    <input type="email" id="set-email" class="form-input" placeholder="you@example.com">
                </div>
                <div>
                    <label class="settings-label">Phone</label>
                    <input type="tel" id="set-phone" class="form-input" placeholder="(555) 123-4567">
                </div>
            </div>

            <label class="settings-label">Gender</label>
            <select id="set-gender" class="form-input">
                <option value="">Select</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Non-binary">Non-binary</option>
                <option value="Prefer not to say">Prefer not to say</option>
                <option value="Other">Other</option>
            </select>

        <button onclick="window.saveSettings()" class="create-btn-sidebar">Save Changes</button>
        <button onclick="window.openVerificationRequest()" class="icon-pill" style="margin-top:10px; width:100%; justify-content:center;"><i class="ph ph-shield-check"></i> Apply for Verification</button>
        <button onclick="window.toggleSettingsModal(false)" style="margin-top:10px; width:100%; padding:10px; background:transparent; border:1px solid var(--border); color:var(--text-muted); border-radius:30px; cursor:pointer;">Cancel</button>
        </div>

    </div>
</div>

<div id="new-chat-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; font-weight:800;">Start a chat</h3>
            <button class="x-close-btn" onclick="window.toggleNewChatModal(false)">&times;</button>
        </div>
        <input id="chat-search" class="form-input" placeholder="Search by username" oninput="window.searchChatUsers(this.value)">
        <div id="selected-chat-users" style="margin-top:10px;"></div>
        <div id="chat-group-name-row" style="margin-top:10px; display:none;">
            <label class="settings-label" for="chat-group-name">Chat name (optional)</label>
            <input id="chat-group-name" class="form-input" placeholder="Group chat name">
        </div>
        <div id="chat-search-results" style="max-height:200px; overflow:auto; margin-top:10px;"></div>
        <div class="modal-actions">
            <button class="icon-pill" onclick="window.toggleNewChatModal(false)"><i class="ph ph-x"></i> Cancel</button>
            <button id="start-chat-btn" class="create-btn-sidebar" onclick="window.startChatFromSelection()" disabled>Start chat</button>
        </div>
    </div>
</div>

<div id="video-upload-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; font-weight:800;">Create Video</h3>
            <button class="x-close-btn" onclick="window.toggleVideoUploadModal(false)">&times;</button>
        </div>
        <input type="file" id="video-file" accept="video/mp4" class="form-input">
        <label class="settings-label">Caption</label>
        <textarea id="video-caption" class="form-input" rows="2"></textarea>
        <label class="settings-label">Hashtags (comma separated)</label>
        <input id="video-tags" class="form-input" placeholder="#nexera,#coding">
        <label class="settings-label">Visibility</label>
        <select id="video-visibility" class="form-input"><option value="public">Public</option><option value="private">Private</option></select>
        <button class="create-btn-sidebar" onclick="window.uploadVideo()">Publish</button>
    </div>
</div>

<div id="go-live-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; font-weight:800;">Go Live</h3>
            <button class="x-close-btn" onclick="window.toggleGoLiveModal(false)">&times;</button>
        </div>
        <input id="live-title" class="form-input" placeholder="Session title">
        <input id="live-category" class="form-input" placeholder="Category">
        <input id="live-tags" class="form-input" placeholder="Tags (comma separated)">
        <input id="live-url" class="form-input" placeholder="Stream embed URL">
        <button class="create-btn-sidebar" onclick="window.createLiveSession()">Start Live</button>
    </div>
</div>

<div id="verification-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0; font-weight:800;">Apply for Verification</h3>
            <button class="x-close-btn" onclick="window.toggleVerificationModal(false)">&times;</button>
        </div>
        <label class="settings-label">Category</label>
        <input id="verify-category" class="form-input" placeholder="creator / journalist / org">
        <label class="settings-label">Evidence Links (one per line)</label>
        <textarea id="verify-links" class="form-input" rows="3"></textarea>
        <label class="settings-label">Notes</label>
        <textarea id="verify-notes" class="form-input" rows="2"></textarea>
        <button class="create-btn-sidebar" onclick="window.submitVerificationRequest()">Submit Request</button>
    </div>
</div>

<!-- Review Modal -->
<div id="review-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; margin-bottom:1rem;">
            <h2 style="font-weight:800;"><i class="ph ph-scales"></i> Peer Review</h2>
            <button onclick="window.closeReview()" style="background:none; border:none; color:var(--text-muted); font-size:1.5rem;">&times;</button>
        </div>

        <div style="background:#000; padding:1rem; border-radius:8px; margin-bottom:1rem; text-align:center;">
            <div id="review-bar" style="display:flex; height:8px; background:#333; border-radius:4px; overflow:hidden; margin-bottom:10px;"></div>
            <div id="review-stats-text" style="font-size:0.85rem; font-weight:bold;">Loading...</div>
        </div>

        <div id="review-list" style="max-height:200px; overflow-y:auto; margin-bottom:1rem;"></div>

        <div id="review-submit-section">
            <h3 style="font-size:1rem; margin-bottom:10px;">Submit Audit</h3>
            <select id="review-rating" class="form-select">
                <option value="verified">Verified Accurate</option>
                <option value="citation">Needs Citations</option>
                <option value="misleading">Misleading / False</option>
            </select>
            <textarea id="review-note" class="form-input" rows="2" placeholder="Explanation..."></textarea>
            <button onclick="window.submitReview()" class="create-btn-sidebar" style="margin-top:0;">Submit Review</button>
        </div>

        <div id="review-remove-section" style="display:none; text-align:center; padding-top:10px; border-top:1px solid var(--border);">
            <div id="review-user-status" style="margin-bottom:10px; font-weight:bold; color:var(--text-main);"></div>
            <button onclick="window.removeReview()" class="create-btn-sidebar" style="background:#ff3d3d; border:none; color:white; width:auto; padding: 10px 20px;">Remove My Review</button>
        </div>
    </div>
</div>

<div id="post-options-modal" class="modal-overlay">
    <div class="modal-content" style="max-width:420px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0; font-weight:800;">Post Options</h3>
            <button class="x-close-btn" onclick="window.closePostOptions()">&times;</button>
        </div>
        <div id="post-options-actions" style="display:flex; flex-direction:column; gap:10px;">
            <button class="icon-pill" onclick="window.openReportModal()"><i class="ph ph-flag"></i> Report</button>
            <button id="delete-post-btn" class="icon-pill" style="display:none; background:#ff3d3d; border:none; color:white;" onclick="window.confirmDeletePost()">
                <i class="ph ph-trash"></i> Delete
            </button>
        </div>
    </div>
</div>

<div id="post-options-dropdown" class="post-options-dropdown menu-surface">
    <button id="dropdown-edit-btn" style="display:none;" onclick="window.handlePostOptionSelect('edit')"><i class="ph ph-pencil"></i> Edit Post</button>
    <button id="dropdown-share-btn" onclick="window.handlePostOptionSelect('share')"><i class="ph ph-paper-plane-tilt"></i> Share</button>
    <button id="dropdown-message-btn" onclick="window.handlePostOptionSelect('message')"><i class="ph ph-chats"></i> Message author</button>
    <button onclick="window.handlePostOptionSelect('report')"><i class="ph ph-flag"></i> Report</button>
    <button id="dropdown-delete-btn" onclick="window.handlePostOptionSelect('delete')" style="display:none;"><i class="ph ph-trash"></i> Delete</button>
</div>

<div id="report-modal" class="modal-overlay">
    <div class="modal-content" style="max-width:480px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0; font-weight:800;">Report Post</h3>
            <button class="x-close-btn" onclick="window.closeReportModal()">&times;</button>
        </div>
        <label class="settings-label">Category</label>
        <select id="report-category" class="form-select">
            <option value="">Select category</option>
            <option>Spam</option>
            <option>Harassment / Hate</option>
            <option>Nudity / Sexual content</option>
            <option>Violence / Dangerous content</option>
            <option>Misinformation</option>
            <option>Illegal activity</option>
            <option>Other</option>
        </select>
        <label class="settings-label">Details (optional)</label>
        <textarea id="report-details" class="form-input" rows="3" maxlength="500" placeholder="Add any context that helps our team"></textarea>
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:12px;">
            <button class="icon-pill" onclick="window.closeReportModal()">Cancel</button>
            <button class="create-btn-sidebar" style="width:auto;" onclick="window.submitReport()">Report</button>
        </div>
    </div>
</div>

<div id="confirm-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
    <div class="modal-content compact">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
            <h3 id="confirm-title" style="margin:0; font-weight:800;">Confirm</h3>
            <button class="x-close-btn" onclick="window.cancelConfirmModal()">&times;</button>
        </div>
        <div id="confirm-body" class="confirm-message"></div>
        <div id="confirm-helper" class="confirm-helper"></div>
        <div id="confirm-extra"></div>
        <div class="confirm-actions">
            <button id="confirm-cancel-btn" class="icon-pill" onclick="window.cancelConfirmModal()"><i class="ph ph-x"></i> Cancel</button>
            <button id="confirm-submit-btn" class="create-btn-sidebar" style="width:auto;"><span id="confirm-submit-label">Confirm</span></button>
        </div>
    </div>
</div>

<!-- App Layout -->
<header class="mobile-app-bar">
    <div class="mobile-app-bar__left" onclick="window.navigateTo('feed')">
        <img class="brand-logo brand-logo-mobile" data-logo-variant="icon" alt="Nexera logo" src="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Ficon.png?alt=media&token=3db62710-7412-46bf-a981-ace4715e2bc6">
        <div class="mobile-app-meta">
            <span class="mobile-app-title">Nexera</span>
            <span id="mobile-section-label" class="mobile-section-label">Home</span>
        </div>
    </div>
    <div class="mobile-app-bar__actions">
        <button class="icon-btn" onclick="window.toggleDiscoverSearch()" aria-label="Search"><i class="ph ph-magnifying-glass"></i></button>
        <button class="icon-btn" onclick="window.openMobileActionSheet()" aria-label="Create"><i class="ph ph-plus"></i></button>
        <button class="icon-btn" onclick="window.navigateTo('profile')" aria-label="Profile"><i class="ph ph-user"></i></button>
    </div>
</header>

<div id="app-layout" class="app-layout">
    <nav class="sidebar-left glass-panel">
        <div class="brand-nav" style="margin-bottom:2rem;" onclick="window.navigateTo('feed')">
            <img class="brand-logo brand-logo-nav" data-logo-variant="auto" alt="Nexera" src="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Fwhiteicon.png?alt=media&token=366d09a9-61f6-4096-af08-a01a119c339e">
            <span class="brand-wordmark nexara-gradient-text">Nexera</span>
        </div>
        <a onclick="window.navigateTo('feed')" id="nav-feed" class="nav-item active"><i class="ph-bold ph-house"></i> Home</a>
        <a onclick="window.navigateTo('live')" id="nav-live" class="nav-item"><i class="ph-bold ph-broadcast"></i> Live</a>
        <a onclick="window.navigateTo('videos')" id="nav-videos" class="nav-item"><i class="ph-bold ph-film-strip"></i> Videos</a>
        <a onclick="window.openMessagesPage()" id="nav-messages" class="nav-item"><i class="ph-bold ph-chats"></i> Messages</a>
        <a onclick="window.navigateTo('discover')" id="nav-discover" class="nav-item"><i class="ph-bold ph-compass"></i> Discover</a>
        <a onclick="window.navigateTo('saved')" id="nav-saved" class="nav-item"><i class="ph-bold ph-bookmark"></i> Saved</a>
        <a onclick="window.navigateTo('profile')" id="nav-profile" class="nav-item"><i class="ph-bold ph-user"></i> Profile</a>
        <a onclick="window.navigateTo('staff')" id="nav-staff" class="nav-item" style="display:none;"><i class="ph-bold ph-shield-star"></i> Staff</a>
        <button onclick="window.toggleCreateModal(true)" class="create-btn-sidebar"><i class="ph-bold ph-plus"></i> Post</button>
    </nav>

    <main class="main-feed">
        <div id="view-feed" class="view-section">
        <div id="category-header" class="category-header"></div>
            <div id="feed-content" style="padding:1rem; max-width:800px; margin:0 auto;"></div>
        </div>

        <div id="view-saved" class="view-section" style="display:none;">
            <div style="padding: 1rem 1rem 0 1rem;">
                <h2 style="font-weight:800; font-size:1.5rem; margin-bottom:1rem;">Saved Posts</h2>
                <input type="text" class="form-input" placeholder="Search your saved posts..." oninput="window.handleSavedSearch(event)">

                <div style="display:flex; gap:10px; margin-bottom:1rem; overflow-x:auto; padding-bottom:5px;">
                    <button class="saved-pill active" onclick="window.setSavedFilter('All Saved')">All Saved</button>
                    <button class="saved-pill" onclick="window.setSavedFilter('Recent')">Recently Saved</button>
                    <button class="saved-pill" onclick="window.setSavedFilter('Oldest')">Oldest Saved</button>
                    <button class="saved-pill" onclick="window.setSavedFilter('Videos')">Videos</button>
                    <button class="saved-pill" onclick="window.setSavedFilter('Images')">Images</button>
                </div>
            </div>
            <div id="saved-content" style="padding:1rem; max-width:800px; margin:0 auto;"></div>
        </div>

        <div id="view-thread" class="view-section" style="display:none;">
            <div class="glass-panel" style="position: sticky; top: 0; z-index: 20; padding: 1rem; display: flex; align-items: center; gap: 15px;">
                 <button onclick="window.goBack()" class="back-btn-outline" style="background: none; color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 5px;">
                    <span>‚Üê</span> Back
                </button>
                <h2 style="font-weight: 800; font-size: 1.2rem;">Discuss</h2>
            </div>
            <div id="thread-main-post"></div>

            <div id="thread-input-default-slot" style="padding: 1rem; border-bottom: 1px solid var(--border);">
                <div id="thread-input-area" style="display: flex; gap: 10px;">
                     <div id="thread-input-pfp" style="width: 40px; height: 40px; border-radius: 12px; background: #333;"></div>
                     <div style="flex: 1;">
                         <textarea id="thread-input" class="form-input" placeholder="Post your reply" rows="2" style="margin-bottom: 5px; background: transparent; border: none; border-bottom: 1px solid var(--border); border-radius: 0; padding: 10px 0;"></textarea>
                         <div style="display: flex; justify-content: space-between; align-items: center;">
                             <div>
                                 <input type="file" id="thread-file" style="display: none;" onchange="window.handleFileSelect(this)">
                                 <button onclick="window.triggerFileSelect()" style="background: none; border: none; color: var(--primary); cursor: pointer; font-size: 0.9rem;" id="attach-btn-text">üìé Attach</button>
                             </div>
                             <div>
                                 <button id="thread-cancel-btn" onclick="window.resetInputBox()" style="background: transparent; color: var(--text-muted); border: none; margin-right: 10px; cursor: pointer; display: none;">Cancel</button>
                                 <button id="thread-send-btn" onclick="window.sendComment()" class="create-btn-sidebar" style="width: auto; padding: 6px 15px; margin-top: 0; font-size: 0.9rem;">Reply</button>
                             </div>
                         </div>
                     </div>
                </div>
            </div>
            <div class="thread-filter-row">
                <label for="comment-filter-mode" class="thread-filter-label">Filter</label>
                <select id="comment-filter-mode" class="form-input" style="max-width:220px;" onchange="window.updateCommentFilterMode(this.value)">
                    <option value="popularity">Popularity</option>
                    <option value="user">User</option>
                    <option value="datetime">Date/Time</option>
                    <option value="content">Content</option>
                </select>
                <input id="comment-filter-input" class="form-input" style="display:none; max-width:260px;" placeholder="Type to filter..." oninput="window.updateCommentFilterQuery(this.value)">
            </div>
            <div id="thread-stream" style="padding: 1rem; max-width: 800px; margin: 0 auto;"></div>
        </div>

        <div id="view-public-profile" class="view-section" style="display:none;"></div>

        <div id="view-discover" class="view-section" style="display:none;">
            <div id="discover-topbar"></div>
            <div id="discover-results" style="padding: 0 1rem 1rem 1rem; max-width:800px; margin:0 auto;">
                <div class="empty-state"><p>Start typing to search or explore categories.</p></div>
            </div>
        </div>

        <div id="view-live" class="view-section live-view" style="display:none;">
            <div class="live-view-shell">
                <div id="live-topbar"></div>
                <div id="live-featured-row" class="live-featured-row"></div>
                <div id="live-filter-row" class="live-filter-row"></div>
                <hr id="live-divider" class="live-divider">
                <div id="live-directory-grid" class="live-grid live-directory-grid"></div>
            </div>
        </div>
        
                <div id="view-live-setup" class="view-section" style="display:none;">
            <div id="go-live-root" class="go-live-studio ui-basic is-active">
        <div class="go-live-studio-topbar gl-panel">
            <div class="topbar-left">
                <button class="icon-pill ghost go-live-back-btn" type="button" id="go-live-back-button"><i class="ph ph-caret-left"></i> Back</button>
                <div class="go-live-title-block">
                    <div class="go-live-title">Go Live Setup</div>
                    <p class="go-live-subtitle">Streaming Center</p>
                </div>
            </div>
            <div class="topbar-right">
                <div class="gl-pill status-pill ready topbar-status-chip" id="go-live-top-status">Ready</div>
                <label for="go-live-ui-config" class="topbar-label">UI Config:</label>
                <select id="go-live-ui-config" class="go-live-select form-input">
                    <option value="basic">Basic</option>
                    <option value="advanced">Advanced</option>
                </select>
            </div>
        </div>
        <div class="go-live-views">
            <section id="go-live-basic-view" class="go-live-view is-active">
                <div class="basic-layout">
                    <div class="basic-preview-column">
                        <div class="preview-pane gl-panel">
                            <div class="preview-pane-header">
                                <div class="status-chip-row">
                                    <div class="gl-pill go-live-status-outside" id="go-live-status">Ready</div>
                                    <div class="gl-pill subtle" id="go-live-visibility-pill">Preview</div>
                                </div>
                                <div class="stream-health">
                                    <span class="muted">Stream Health</span>
                                    <div class="health-dot good"></div>
                                </div>
                            </div>
                            <div class="preview-video-frame" id="live-preview-slot-basic">
                                <div id="live-preview-shell" class="preview-visual">
                                    <video id="live-preview" autoplay muted playsinline></video>
                                    <div class="preview-overlay">
                                        <div class="state-callout preview-corner-status" id="go-live-state-chip">Idle</div>
                                        <div class="overlay-meta basic-overlay-strip">
                                            <div class="overlay-label">Status</div>
                                            <div class="overlay-text" id="go-live-status-text">Idle</div>
                                            <div class="overlay-label">Notes</div>
                                            <div class="overlay-text">Stream will appear here once started.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="preview-footer">
                                <div class="preview-note">Use this preview to verify audio/video before you go live.</div>
                            </div>
                            <div class="gl-panel subtle-panel chat-placeholder" aria-label="Live chat placeholder">
                                <div class="section-heading">Live Chat</div>
                                <div class="chat-body-placeholder">Chat will appear here when enabled.</div>
                                <div class="chat-composer-placeholder">
                                    <input class="form-input" placeholder="Chat coming soon‚Ä¶" disabled>
                                    <button class="icon-pill" type="button" disabled>Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="basic-config-column">
                        <div class="config-shell gl-panel">
                            <div class="config-scroll">
                                <div class="config-section">
                                    <div class="section-heading">Stream Details</div>
                                    <div class="gl-field">
                                        <label class="gl-label" for="stream-title">Title</label>
                                        <input id="stream-title" class="form-input" placeholder="Name your stream">
                                    </div>
                                    <div class="gl-field">
                                        <label class="gl-label" for="stream-category">Category</label>
                                        <input id="stream-category" class="form-input" placeholder="Gaming, IRL, Podcast...">
                                    </div>
                                      <div class="gl-field">
                                          <label class="gl-label" for="stream-tags">Tags</label>
                                          <input id="stream-tags" class="form-input" placeholder="Add tags separated by commas">
                                      </div>
                                  </div>
                                <div class="config-section">
                                    <div class="section-heading">Source</div>
                                    <p class="helper-text">Choose what you want to share. You can swap inputs while previewing.</p>
                                    <div class="gl-field">
                                        <label class="gl-label" for="input-mode">Input mode</label>
                                        <select id="input-mode" class="form-input">
                                            <option value="camera">Camera</option>
                                            <option value="screen">Screen Share</option>
                                            <option value="external">External Encoder</option>
                                        </select>
                                    </div>
                                    <div id="obs-panel-slot-basic">
                                        <div id="obs-panel" class="obs-panel">
                                            <div class="obs-panel-title">OBS / External encoder</div>
                                            <p class="helper-text">Point your encoder here when using RTMP.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="config-section">
                                    <div class="section-heading">Visibility</div>
                                    <p class="helper-text">Choose who can watch your stream.</p>
                                    <div class="pill-row">
                                        <button class="ghost-pill active" type="button" id="basic-visibility-public" data-go-live-visibility="public">Public</button>
                                        <button class="ghost-pill" type="button" id="basic-visibility-private" data-go-live-visibility="private">Private</button>
                                    </div>
                                </div>
                                <div class="config-section basic-latency-section">
                                    <div class="section-heading">Latency</div>
                                    <p class="helper-text">Lower latency reduces delay with your viewers but can be less forgiving on unstable connections.</p>
                                    <div class="gl-field">
                                        <label class="gl-label" for="latency-mode">Latency profile</label>
                                        <select id="latency-mode" class="form-input">
                                            <option value="NORMAL">Normal</option>
                                            <option value="LOW">Low Latency</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="config-section basic-recording-section">
                                    <div class="section-heading">Recording</div>
                                    <p class="helper-text">Automatically capture your broadcast for replay while you stream.</p>
                                    <div class="gl-row align-center">
                                        <div class="gl-label">Auto-record</div>
                                        <label class="switch" aria-label="Toggle auto recording">
                                            <input type="checkbox" id="auto-record-toggle">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                                <div class="config-section">
                                    <div class="section-heading">Controls</div>
                                    <div class="status-helper" id="go-live-status-text-secondary">Ready to preview.</div>
                                    <div class="control-row">
                                        <button class="create-btn-sidebar primary go-live-action-btn" id="start-stream">Start Stream</button>
                                        <button class="icon-pill destructive go-live-action-btn" id="end-stream" disabled>End Stream</button>
                                    </div>
                                    <div class="troubleshooting">
                                        <div class="troubleshooting-title">Troubleshooting</div>
                                        <ul>
                                            <li>Check mic permissions</li>
                                            <li>Check screen share permissions</li>
                                            <li>Try reloading</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section id="go-live-advanced-view" class="go-live-view">
                <div class="advanced-layout">
                    <div class="gl-panel advanced-card advanced-config">
                        <div class="gl-panel-header">
                            <div class="section-heading">Stream Controls</div>
                            <div class="status-helper" id="go-live-status-text-secondary-adv">Manage settings before going live.</div>
                        </div>
                        <div class="config-grid">
                            <div class="gl-field">
                                <label class="gl-label" for="adv-stream-title">Title</label>
                                <input id="adv-stream-title" class="form-input" placeholder="Name your stream">
                            </div>
                            <div class="gl-field">
                                <label class="gl-label" for="adv-stream-category">Category</label>
                                <input id="adv-stream-category" class="form-input" placeholder="Gaming, IRL, Podcast...">
                            </div>
                            <div class="gl-field">
                                <label class="gl-label" for="adv-stream-tags">Tags</label>
                                <input id="adv-stream-tags" class="form-input" placeholder="Add tags separated by commas">
                            </div>
                            <div class="gl-field">
                                <label class="gl-label" for="adv-input-mode">Input mode</label>
                                <select id="adv-input-mode" class="form-input">
                                    <option value="camera">Camera</option>
                                    <option value="screen">Screen Share</option>
                                    <option value="external">External Encoder</option>
                                </select>
                            </div>
                            <div class="gl-field">
                                <label class="gl-label" for="adv-latency-mode">Latency profile</label>
                                <select id="adv-latency-mode" class="form-input">
                                    <option value="NORMAL">Normal</option>
                                    <option value="LOW">Low Latency</option>
                                </select>
                            </div>
                            <div class="gl-row align-center">
                                <div class="gl-label">Auto-record</div>
                                <label class="switch" aria-label="Toggle auto recording in advanced view">
                                    <input type="checkbox" id="adv-auto-record">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="advanced-actions">
                            <div class="gl-row align-center gap-8">
                                <div class="gl-label muted">Visibility</div>
                                <div class="pill-row">
                                    <button class="ghost-pill active" type="button" id="adv-visibility-public">Public</button>
                                    <button class="ghost-pill" type="button" id="adv-visibility-private">Private</button>
                                </div>
                            </div>
                            <div class="control-row">
                                <button class="create-btn-sidebar primary" id="adv-start-stream">Start Stream</button>
                                <button class="icon-pill destructive" id="adv-end-stream" disabled>End Stream</button>
                            </div>
                        </div>
                    </div>
                    <div class="advanced-grid">
                        <div class="gl-panel advanced-card scenes-panel">
                            <div class="gl-panel-header">
                                <div class="section-heading">Scenes &amp; Sources</div>
                                <div class="scene-actions">
                                    <button class="icon-pill ghost" type="button"><i class="ph ph-plus"></i> Scene</button>
                                    <button class="icon-pill ghost" type="button"><i class="ph ph-plus"></i> Source</button>
                                </div>
                            </div>
                            <div class="scene-search">
                                <input class="form-input" type="text" placeholder="Search scenes">
                            </div>
                            <div class="scene-list">
                                <div class="scene-row active">
                                    <span>Scene 1 ‚Äì Main</span>
                                    <span class="muted">Live</span>
                                </div>
                                <div class="scene-row">
                                    <span>Scene 2 ‚Äì Intermission</span>
                                    <span class="muted">Standby</span>
                                </div>
                                <div class="scene-row">
                                    <span>Scene 3 ‚Äì BRB</span>
                                    <span class="muted">Standby</span>
                                </div>
                            </div>
                            <div class="source-subpanel">
                                <div class="section-subheading">Sources</div>
                                <div class="source-list">
                                    <div class="source-row">Camera 1</div>
                                    <div class="source-row">Screen Capture</div>
                                    <div class="source-row">Overlay: Alerts</div>
                                </div>
                            </div>
                        </div>
                        <div class="gl-panel advanced-card program-card">
                            <div class="program-grid">
                                <div class="monitor program-monitor">
                                    <div class="monitor-label">PROGRAM</div>
                                    <div class="monitor-body"></div>
                                </div>
                                <div class="monitor preview-monitor">
                                    <div class="monitor-label">PREVIEW</div>
                                    <div class="monitor-body" id="live-preview-slot-advanced"></div>
                                </div>
                            </div>
                            <div class="program-meta">
                                <div class="live-indicator">LIVE</div>
                                <div class="program-timer">00:00:00</div>
                                <div class="program-notes">Program/preview monitors ready for switching.</div>
                            </div>
                            <div class="transition-strip">
                                <div class="transition-buttons">
                                    <button class="icon-pill ghost" type="button">Cut</button>
                                    <button class="icon-pill ghost" type="button">Fade</button>
                                    <button class="icon-pill ghost" type="button">Auto</button>
                                </div>
                                <div class="transition-duration">Transition duration: 1.5s</div>
                            </div>
                        </div>
                        <div class="advanced-right">
                            <div class="gl-panel advanced-card mixer-card">
                                <div class="gl-panel-header">
                                    <div class="section-heading">Audio Mixer</div>
                                </div>
                                <div class="mixer-grid">
                                    <div class="mixer-strip">
                                        <div class="mixer-title">Mic</div>
                                        <div class="meter"><span class="meter-fill"></span></div>
                                        <div class="mixer-actions">
                                            <button class="icon-pill ghost" type="button">Mute</button>
                                            <button class="icon-pill ghost" type="button">Solo</button>
                                        </div>
                                    </div>
                                    <div class="mixer-strip">
                                        <div class="mixer-title">System</div>
                                        <div class="meter"><span class="meter-fill"></span></div>
                                        <div class="mixer-actions">
                                            <button class="icon-pill ghost" type="button">Mute</button>
                                            <button class="icon-pill ghost" type="button">Solo</button>
                                        </div>
                                    </div>
                                    <div class="mixer-strip">
                                        <div class="mixer-title">Music</div>
                                        <div class="meter"><span class="meter-fill"></span></div>
                                        <div class="mixer-actions">
                                            <button class="icon-pill ghost" type="button">Mute</button>
                                            <button class="icon-pill ghost" type="button">Solo</button>
                                        </div>
                                    </div>
                                    <div class="mixer-strip">
                                        <div class="mixer-title">Aux</div>
                                        <div class="meter"><span class="meter-fill"></span></div>
                                        <div class="mixer-actions">
                                            <button class="icon-pill ghost" type="button">Mute</button>
                                            <button class="icon-pill ghost" type="button">Solo</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="gl-panel advanced-card stats-card">
                                <div class="gl-panel-header">
                                    <div class="section-heading">Stream Stats</div>
                                </div>
                                <div class="stats-grid">
                                    <div class="stat-row"><span>Ingest</span><span class="muted" id="adv-stat-ingest">‚Äî</span></div>
                                    <div class="stat-row"><span>Bitrate</span><span class="muted" id="adv-stat-bitrate">‚Äî</span></div>
                                    <div class="stat-row"><span>RTT</span><span class="muted" id="adv-stat-rtt">‚Äî</span></div>
                                    <div class="stat-row"><span>Dropped Frames</span><span class="muted" id="adv-stat-dropped">‚Äî</span></div>
                                    <div class="stat-row"><span>CPU</span><span class="muted" id="adv-stat-cpu">‚Äî</span></div>
                                    <div class="stat-row"><span>Duration</span><span class="muted" id="adv-stat-duration">00:00:00</span></div>
                                    <div class="stat-row"><span>Tracks</span><span class="muted" id="adv-stat-tracks">‚Äî</span></div>
                                    <div class="stat-row"><span>Input</span><span class="muted" id="adv-stat-mode">‚Äî</span></div>
                                    <div class="stat-row"><span>Health</span><span class="muted" id="adv-stat-health">Monitoring</span></div>
                                </div>
                            </div>
                            <div class="gl-panel advanced-card session-card">
                                <div class="gl-panel-header">
                                    <div class="section-heading">Live Session</div>
                                </div>
                                <div class="session-grid compact">
                                    <div class="session-row"><span class="muted">Session ID</span><span id="session-id-advanced">‚Äî</span></div>
                                    <div class="session-row"><span class="muted">Channel ARN</span><span id="session-arn-advanced">‚Äî</span></div>
                                    <div class="session-row"><span class="muted">Ingest</span><span id="session-ingest-advanced" class="muted">‚Äî</span></div>
                                    <div class="session-row"><span class="muted">Playback</span><span id="session-playback-advanced" class="muted">‚Äî</span></div>
                                    <div class="session-row"><span class="muted">Latency</span><span id="session-latency-advanced" class="muted">‚Äî</span></div>
                                    <div class="session-row"><span class="muted">Auto-record</span><span id="session-auto-advanced" class="muted">‚Äî</span></div>
                                </div>
                            </div>
                            <div class="gl-panel advanced-card obs-advanced">
                                <div class="gl-panel-header">
                                    <div class="section-heading">OBS / External Encoder</div>
                                </div>
                                <div id="obs-panel-slot-advanced" class="obs-slot helper-text">External encoder info will appear here when selected.</div>
                            </div>
                        </div>
                    </div>
                    <div class="gl-panel advanced-tabs">
                        <div class="tab-row">
                            <button class="tab active" type="button">Logs</button>
                            <button class="tab" type="button">Chat</button>
                            <button class="tab" type="button">Stream Events</button>
                            <button class="tab" type="button">Encoder</button>
                        </div>
                        <div class="tab-panels">
                            <div class="tab-panel show">
                                <pre class="log-feed" id="go-live-log-advanced">Awaiting logs...</pre>
                            </div>
                            <div class="tab-panel">
                                <div class="placeholder-block">Chat will appear here.</div>
                            </div>
                            <div class="tab-panel">
                                <div class="placeholder-block">Track stream events here.</div>
                            </div>
                            <div class="tab-panel">
                                <div class="placeholder-block">Encoder configuration placeholder.</div>
                            </div>
                        </div>
                    </section>
                </div>
            </section>
        </div>
    </div>

        <div id="view-videos" class="view-section" style="display:none;">
            <div id="videos-topbar"></div>
            <div id="video-feed" class="video-feed"></div>
        </div>

        <div id="view-messages" class="view-section" style="display:none;">
            <div class="messages-layout">
                <div class="messages-sidebar">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <h3 style="margin:0; font-weight:800;">Messages</h3>
                        <button class="icon-pill" onclick="window.openNewChatModal()"><i class="ph ph-plus"></i> New</button>
                    </div>
                    <div id="conversation-list" class="conversation-list"></div>
                </div>
                <div class="messages-thread">
                    <div id="message-header" class="message-thread-header">Select a conversation</div>
                    <div class="message-header-tools">
                        <input id="conversation-search" class="form-input" placeholder="Search in conversation" oninput="window.handleConversationSearch(this.value)">
                        <div class="search-nav">
                            <button class="icon-pill" onclick="window.navigateConversationSearch(-1)"><i class="ph ph-caret-up"></i></button>
                            <button class="icon-pill" onclick="window.navigateConversationSearch(1)"><i class="ph ph-caret-down"></i></button>
                        </div>
                    </div>
                    <div class="messages-thread-inner">
                        <div id="pinned-messages" class="pinned-messages" style="display:none;"></div>
                        <div class="message-scroll-region">
                            <div id="message-thread" class="message-thread-body"></div>
                            <div id="typing-indicator" class="typing-indicator" style="display:none;"></div>
                        </div>
                    </div>
                    <div id="message-reply-preview" class="message-reply-preview" style="display:none;"></div>
                    <div class="message-compose">
                        <input type="file" id="message-media" accept="image/*" style="display:none;">
                        <button class="icon-pill" onclick="document.getElementById('message-media').click()"><i class="ph ph-image"></i></button>
                        <input id="message-input" class="form-input" placeholder="Message" />
                        <button class="create-btn-sidebar" style="width:auto;" onclick="window.sendMessage()">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-conversation-settings" class="view-section" style="display:none;">
            <div class="messages-settings-shell">
                <div class="messages-settings-header">
                    <button class="icon-pill" onclick="window.backToConversationFromSettings()"><i class="ph ph-arrow-left"></i> Back</button>
                    <div class="messages-settings-meta">
                        <div id="conversation-settings-avatar"></div>
                        <div>
                            <div id="conversation-settings-title" style="font-weight:800;">Conversation Settings</div>
                            <div id="conversation-settings-subtitle" style="color:var(--text-muted); font-size:0.9rem;">Update participants, name, and preferences</div>
                        </div>
                    </div>
                    <button class="icon-pill" onclick="window.refreshConversationSettings()"><i class="ph ph-arrow-clockwise"></i></button>
                </div>

                <div class="messages-settings-grid">
                    <div class="messages-settings-card">
                        <div class="panel-title">Participants</div>
                        <div id="conversation-participant-list"></div>
                        <div class="input-group">
                            <label class="settings-label" for="conversation-add-search">Add participants</label>
                            <input id="conversation-add-search" class="form-input" placeholder="Search by username" oninput="window.searchConversationParticipants(this.value)">
                        </div>
                        <div id="conversation-add-results" style="max-height:200px; overflow:auto;"></div>
                    </div>

                    <div class="messages-settings-card">
                        <div class="panel-title">Conversation details</div>
                        <div id="conversation-created-by" class="conversation-created-by"></div>
                        <label class="settings-label" for="conversation-name-input">Name</label>
                        <input id="conversation-name-input" class="form-input" placeholder="Conversation name">
                        <div id="conversation-name-hint" class="settings-hint"></div>
                        <button class="create-btn-sidebar" style="width:auto;" onclick="window.saveConversationName()">Save name</button>
                        <div class="input-group" style="margin-top:10px;">
                            <label class="settings-label" for="conversation-avatar-input">Conversation image</label>
                            <input id="conversation-avatar-input" type="file" accept="image/*" class="form-input">
                        </div>
                        <div id="conversation-avatar-preview" class="conversation-avatar-preview"></div>
                        <button class="icon-pill" onclick="window.uploadConversationAvatar()"><i class="ph ph-upload"></i> Upload image</button>
                        <div class="settings-chip-row" id="conversation-preferences-row">
                            <button class="icon-pill" id="conversation-mute-btn" onclick="window.toggleConversationMute()"><i class="ph ph-bell-slash"></i> Mute chat</button>
                            <button class="icon-pill" id="conversation-pin-btn" onclick="window.toggleConversationPin()"><i class="ph ph-push-pin"></i> Pin</button>
                            <button class="icon-pill" id="conversation-archive-btn" onclick="window.toggleConversationArchive()"><i class="ph ph-archive"></i> Archive</button>
                        </div>
                    </div>

                    <div class="messages-settings-card">
                        <div class="panel-title">Controls</div>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <button class="icon-pill" onclick="window.blockConversationPartner()"><i class="ph ph-user-x"></i> Block user</button>
                            <button class="icon-pill" onclick="window.reportConversation()"><i class="ph ph-flag"></i> Report conversation</button>
                            <button class="icon-pill" onclick="window.leaveConversation()"><i class="ph ph-door"></i> Leave chat</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-staff" class="view-section" style="display:none;">
            <div style="padding:1rem;">
                <h2 style="font-weight:800; font-size:1.5rem; display:flex; align-items:center; gap:8px;">
                    <i class="ph ph-shield-star"></i> Staff Console
                </h2>
                <div id="staff-access-warning" class="empty-state" style="display:none;">Access denied</div>
                <div id="staff-panels">
                    <div class="staff-grid">
                        <div class="glass-panel">
                            <div class="panel-title">Verification Requests</div>
                            <div id="verification-requests"></div>
                        </div>
                        <div class="glass-panel">
                            <div class="panel-title">Reports Queue</div>
                            <div id="reports-queue"></div>
                        </div>
                        <div class="glass-panel">
                            <div class="panel-title">Admin Logs</div>
                            <div id="admin-logs"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="view-profile" class="view-section" style="display:none;"></div>
    </main>

    <aside class="sidebar-right glass-panel">
        <div class="trend-box">
            <div class="trend-title">Trending <i class="ph-fill ph-trend-up"></i></div>
            <div class="trend-item"><span>#SpaceX</span><span style="color:var(--text-muted);">12k</span></div>
            <div class="trend-item"><span>#AI</span><span style="color:var(--text-muted);">8k</span></div>
        </div>

        <div class="trend-box">
            <div class="trend-title time-capsule-header">
                <span><i class="ph-fill ph-hourglass"></i> Time Capsule</span>
            </div>
            <div class="otd-widget">
                <div class="otd-date" id="otd-date-display">...</div>
                <div class="otd-event" id="otd-event-display">Loading history...</div>
                <div class="otd-actions">
                    <button class="icon-pill" id="otd-refresh-btn" onclick="window.showAnotherTimeCapsuleEvent()" aria-label="Load another event">
                        <i class="ph ph-arrows-clockwise"></i> New one
                    </button>
                    <a id="otd-wiki-link" class="icon-pill otd-source" style="display:none;" aria-label="Learn more about this event">
                        <i class="ph ph-book-open"></i> Learn More
                    </a>
                </div>
                <div class="time-capsule-footer"><a class="wiki-attribution" href="https://www.wikipedia.org" target="_blank" rel="noopener noreferrer">Powered by Wikipedia</a></div>
            </div>
        </div>

        <div style="margin-top:2rem; font-size:0.8rem; color:var(--text-muted);">¬© 2025 Nexera Network</div>
    </aside>
</div>

<nav id="mobile-bottom-nav" class="mobile-bottom-nav">
    <button class="mobile-nav-btn active" data-view="feed"><i class="ph ph-house"></i><span>Home</span></button>
    <button class="mobile-nav-btn" data-view="discover"><i class="ph ph-compass"></i><span>Explore</span></button>
    <button class="mobile-nav-btn" data-view="live"><i class="ph ph-broadcast"></i><span>Go Live</span></button>
    <button class="mobile-nav-btn" data-view="messages"><i class="ph ph-chats"></i><span>Chats</span></button>
    <button class="mobile-nav-btn" data-view="profile"><i class="ph ph-user"></i><span>Profile</span></button>
</nav>

<button id="mobile-fab" class="mobile-fab" aria-label="Create" onclick="window.openMobileComposer()">
    <i class="ph ph-plus"></i>
</button>

<div id="mobile-action-sheet" class="mobile-action-sheet" role="dialog" aria-modal="true">
    <div class="mobile-sheet-backdrop" onclick="window.closeMobileActionSheet()"></div>
    <div class="mobile-sheet-body">
        <div class="mobile-sheet-handle"></div>
        <button class="sheet-action" onclick="window.openMobileComposer()"><i class="ph ph-pencil"></i> Create Post</button>
        <button class="sheet-action" onclick="window.closeMobileActionSheet(); window.openGoLiveSetupPage()"><i class="ph ph-broadcast"></i> Go Live</button>
        <button class="sheet-action" onclick="window.closeMobileActionSheet(); window.toggleVideoUploadModal(true)"><i class="ph ph-film-strip"></i> Upload Video</button>
    </div>
</div>

<div id="mobile-composer-sheet" class="mobile-composer-sheet" role="dialog" aria-modal="true">
    <div class="mobile-sheet-header">
        <button class="sheet-link" onclick="window.closeMobileComposer()">Cancel</button>
        <div class="sheet-title">New Post</div>
        <button id="mobile-compose-submit" class="sheet-link primary" onclick="window.triggerComposerPost()" disabled>Post</button>
    </div>
    <div class="mobile-sheet-content">
        <textarea id="mobile-compose-input" rows="4" placeholder="What's happening?" oninput="window.syncMobileComposerState()"></textarea>
        <div class="mobile-attachment-row">
            <button class="icon-btn" type="button"><i class="ph ph-image"></i></button>
            <button class="icon-btn" type="button"><i class="ph ph-microphone"></i></button>
            <button class="icon-btn" type="button"><i class="ph ph-paperclip"></i></button>
        </div>
    </div>
</div>

    <!-- Splash Screen -->
    <div id="nexera-splash" aria-hidden="true">
        <div class="nexera-splash-center">
            <img class="nexera-splash-logo" src="https://firebasestorage.googleapis.com/v0/b/spike-streaming-service.firebasestorage.app/o/apps%2Fnexera%2Fassets%2Ficons%2Fwhiteicon.png?alt=media&token=366d09a9-61f6-4096-af08-a01a119c339e" alt="Nexera">
            <div class="splash-spinner" aria-hidden="true"></div>
        </div>
    </div>

    <!-- Main JS logic -->
    <script type="module" src="/main.js"></script>

</body>
</html>

